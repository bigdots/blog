<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>
        yzg的个人站
    </title>
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-reply replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            实现弹出框的鼠标拖拽效果
        </p>
        <hr>
    </div>
    <div class="post-content">
        <h2 id="先引入几个与定位有关的概念："><a href="#先引入几个与定位有关的概念：" class="headerlink" title="先引入几个与定位有关的概念："></a>先引入几个与定位有关的概念：</h2><ul>
<li><p>javascript:</p>
<ul>
<li><p>clientX/clientY属性：获得事件发生时鼠标指针在视口中的水平和垂直坐标。</p>
</li>
<li><p>screenX/screenY属性：获取鼠标事件发生时鼠标光标相对于整个电脑屏幕的坐标信息。</p>
</li>
<li><p>pageX/pageY属性：可以获得鼠标事件发生时鼠标光标相对于整个文档元素的坐标位置（包含滚动）。在页面没有滚动的情况下，通常pageX/pageY的值与clientX/clientY的值相等。</p>
</li>
<li><p>layerX/layerY属性：他是对于绝对定位元素来说的，相对于当前点击元素的左上角定位的。当页面上的元素时相对定位（position:relative）的时候，通常pageX/pageY和layerX/layerY的值是相同的，但是当元素绝对定位(position:absolute)了的时候，layerX/layerY就将鼠标光标位置相对于本身的左上角定位了。</p>
</li>
</ul>
</li>
</ul>
<span id="more"></span>

<ul>
<li><p>jquery:</p>
<ul>
<li><p>position()<br>获取匹配元素相对父元素的偏移。<br>返回的对象包含两个整型属性：top 和 left。为精确计算结果，请在补白、边框和填充属性上使用像素单位。此方法只对可见元素有效。</p>
</li>
<li><p>offset()<br>获取匹配元素在当前视口的相对偏移。<br>返回的对象包含两个整型属性：top 和 left，以像素计。此方法只对可见元素有效。</p>
</li>
<li><p>event.pageX<br>鼠标相对于文档的左边缘的位置。</p>
</li>
<li><p>event.pageY<br>鼠标相对于文档的上边缘的位置。</p>
</li>
</ul>
</li>
</ul>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><ol>
<li><p>鼠标在弹出框上按下时，获取鼠标相对于弹出框的left和top值l、t，这时弹出框状态改为可拖动（mousedown事件）</p>
</li>
<li><p>当弹出框状态为可拖动时：（mousemove事件）</p>
</li>
</ol>
<p>　　①重新定位弹出框的位置；（获取鼠标相对于可视区域的left和top值L、T，并且弹出的坐标移动，它的offsetLeft为L-l；offsetTop为T-t）</p>
<p>　　②限定弹出框的运动范围；</p>
<ol start="3">
<li>当鼠标按钮弹起时，弹出框不在移动，即状态改为不可拖动；（mouseup）</li>
</ol>
<h2 id="上代码"><a href="#上代码" class="headerlink" title="上代码"></a>上代码</h2><p>HTML</p>
<pre><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;
&lt;title&gt;鼠标拖拽事件&lt;/title&gt;
&lt;style&gt;
*&#123;
    margin:0;
    padding: 0;
&#125;

#container&#123;
    width: 380px;
    border: 1px solid #999;
    position: absolute;
    z-index: 5;
&#125;
#mask&#123;
    position: absolute;
    height:100%;
    width: 100%;
    background: black;
    opacity: 0.6;
    /*filter:alpha(opacity=40);*/
    z-index: 1;
    left: 0;
    top:0;
&#125;
#top&#123;
    background: #ccc;
    height: 30px;
    cursor: pointer;
&#125;
#content&#123;
    height: 100px;
    line-height: 20px;
    background: #fff;
    padding: 20px 0 0 0;
&#125;
p&#123;
    text-align: center;
&#125;
&lt;/style&gt;
&lt;script src=&#39;demo.js&#39;&gt;&lt;/script&gt;
&lt;body&gt;
    &lt;div id=&#39;mask&#39;&gt;&lt;/div&gt;
    &lt;div id=&#39;container&#39;&gt;
        &lt;div id=&#39;top&#39;&gt;&lt;/div&gt;
        &lt;div id=&#39;content&#39;&gt;
            &lt;p&gt;&lt;label&gt;请输入用户名&lt;/label&gt;&lt;input type=&#39;text&#39; class=&#39;ipt&#39;&gt;&lt;/p&gt;
            &lt;p&gt;&lt;label&gt;  请输入密码&lt;/label&gt;&lt;input  type=&#39;password&#39; class=&#39;ipt&#39;&gt;&lt;/p&gt;
        &lt;/div&gt;

    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>JavaScript实现</p>
<pre><code>window.onload=function()&#123;
    var container=document.getElementById(&#39;container&#39;);
    var top=document.getElementById(&#39;top&#39;);
    var oMask=document.getElementById(&#39;mask&#39;)
    console.log(container);
    var startX ;
    var startY;
    var flag=false;
    top.onmousedown=function(e)&#123;
        var e= e||window.event;
        startX=e.clientX-container.offsetLeft;           //获取鼠标点与container的相对位置
        startY=e.clientY-container.offsetTop;
        flag=true;
    &#125;


container.onmousemove=function(e)&#123;
    var e= e||window.event;
    var endX=e.clientX;
    var endY=e.clientY;
    var moveX=endX-startX;
    var moveY=endY-startY;
    
    //范围限定
    var maxW=oMask.offsetWidth-container.offsetWidth;   
    var maxH=oMask.offsetHeight-container.offsetHeight;
    moveX=Math.min(maxW,Math.max(0,moveX));             //取得范围在[0,maxW]之间的值
    moveY=Math.min(maxH,Math.max(0,moveY));

    if(flag==true)&#123;
        container.style.left=moveX+&#39;px&#39;;           //鼠标与可视区域的相对位置-鼠标点与container的相对位置=container与可视区域的相对位置
        container.style.top =moveY+&#39;px&#39;;
    &#125;
    
&#125;
document.onmouseup=function(e)&#123;
    flag=false;
&#125;

&#125;
</code></pre>
<p>Jquery实现</p>
<pre><code>$(function()&#123;
    var flag=false;
    var mouseLeft;
    var mouseTop;
    $(&#39;#top&#39;).mousedown(function(event)&#123;  
        var downX=event.pageX;       //获取鼠标坐标
        var downY=event.pageY;
        var offsetLeft=$(&#39;#container&#39;).position().left    //获取弹出框的left值
        var offsetTop =$(&#39;#container&#39;).position().top
        mouseLeft=downX-offsetLeft;       //计算鼠标在弹出框中的位置
        mouseTop =downY-offsetTop;
        //console.log(mouseLeft)
        flag=true;
    &#125;)



$(document).mousemove(function(event)&#123;  
    
    if(flag==true)&#123;
        var moveX=event.pageX;       //获取鼠标坐标
        var moveY=event.pageY;
        var moveLeft=moveX-mouseLeft;  //获取移动过程中弹出框的left值
        var moveTop =moveY-mouseTop;
        var maxX=$(document).width() -$(&#39;#container&#39;).outerWidth();
        var maxY=$(document).height()-$(&#39;#container&#39;).outerHeight();
        console.log($(&#39;#container&#39;).outerWidth())
        //范围限定
        moveLeft=Math.min(Math.max(0,moveLeft),maxX);
        moveTop =Math.min(Math.max(0,moveTop),maxY);
        //console.log(moveLeft)
        $(&#39;#container&#39;).css(&#123;&#39;left&#39;:moveLeft,&#39;top&#39;:moveTop,&#39;backgroud&#39;:&#39;red&#39;&#125;);
    &#125;
    
&#125;)



$(document).mouseup(function(event)&#123;  
    flag=false;
&#125;)
</code></pre>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p>Copyright © 2020 <a class="flink" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>-<a class="flink" target="_blank" rel="noopener" href="https://github.com/sanjinhub/hexo-theme-geek">Geek</a>.
        <label class="el-switch el-switch-green el-switch-sm" style="vertical-align: sub;">
            <input type="checkbox" name="switch" id="update_style">
            <span class="el-switch-style"></span>
        </label>
<!--         <script type="text/javascript">
        var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
        document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
        </script> -->
    </p>
</div>
<input type="hidden" id="web_style" value="black">
<input type="hidden" id="valine_appid" value="cbTPc8u7ho07U6TmlFC0RjK7">
<input type="hidden" id="valine_appKey" value="4hH8asmBIHG3iSVSUt8Hu5OP">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
    color: #698fca;
}

.v .vlist .vcard .vhead .vsys {
    color: #3a3e4a;
}

.v .vlist .vcard .vh .vmeta .vat {
    color: #638fd5;
}

.v .vlist .vcard .vhead .vnick {
    color: #6ba1ff;
}

.v a {
    color: #8696b1;
}

.v .vlist .vcard .vhead .vnick:hover {
    color: #669bfc;
}
</style>
</body>

</html>